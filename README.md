# Бот для Кафе Азу во время Ифтара
## Описание
Бот позволяет резервировать столы и сеты на определенные дни в кафе.

## Технологии
- Python 3.11
- aiogram 3.1.1
- Django 4.2.7
- SunriseSunset.io API

# Установка
## Копирование репозитория
Клонируем репозиторий
```
~ git clone git@github.com:Studio-Yandex-Practicum-Hackathons/cafe_azu_bot_2.git
```

## Виртуальное окружение
Переходим в клонированный репозиторий
```
~ cd {путь до папки с клонированным репозиторем}
~ cd cafe_azu_bot_2
```
Устанавливаем и активируем виртуальное окружение
```
~ py -3.11 -m venv venv
~ . venv/Scripts/activate
```
Устанавливаем требуемые зависимости:
```
~ pip install -r requirements.txt
```

## База данных
В azu_bot_django/azu_bot_django/settings.py выбрать нужную базу данных (sqlite3 или postgresql)
### env
Выполнять только если ваша база данных postgresql, иначе пропустить этот шаг.

Создать файл .env со следующими строками для базы данных:
- DATABASE_NAME = <Имя для подключения к базе данных>
- DATABASE_USERNAME = <Имя пользователя для подключения к базе данных>
- DATABASE_PASSWORD = <Пароль для подключения к базе данных>
- DATABASE_HOST = <Адрес для подключения к базе данных>
- DATABASE_PORT = <Порт для подключения к базе данных>

### Миграция базы данных
Переходим в раздел с базой данных:
```
~ cd azu_bot_django
```
Создаем миграцию для базы данных:
```
~ py manage.py makemigrations cafe tables menu admin_users reservation
```
И применяем её:
```
~ py manage.py migrate
```
Создаем суперпользователя:
```
~ py manage.py createsuperuser
```
Вводим поочередно Имя пользователя, почту и пароль.
После чего запускаем базу данных:
```
~ py manage.py runserver
```

### Наполнение базы данных
Доступ к сервису становится доступен по [адресу](http://127.0.0.1:8000/admin/)

По указаному адресу нужно создать хотя бы по одному экземпляру кафе, стола, блюда, сета.

Так же можно наполнить базу данных готовыми сетами, блюдами и кафе:
```
~ py manage.py load_data_menu
~ py manage.py load_data_cafe
```

Создать пользователя-бота и по [адресу](http://127.0.0.1:8000/admin/authtoken/tokenproxy/) нужно создать токен для бота.

## Телеграмм-бот
### env
В уже существующем файле .env добавить строки:
- TOKEN = <Токен бота, можно получить у BotFather>
- ADMIN_ID = <ID телеграмм-аккаунта админа>
- PROVIDER_TOKEN = <Токен платежной системы>
- DJANGO_TOKEN = <Токен для бота, который был создан в разделе базы данных>

### Запуск
Для полного запуска телеграмм-бота с базой данных нужно:
- Выполнить все вышеуказанные действия по установке.
- Перейти в папку с базой данных и запустить её:
```
~ cd azu_bot_django
~ py manage.py runserver
```
- Выйти из папки с базой данных, перейти в папку бота, запустить бота:
```
~ cd azu_bot_aiogram
~ py main.py
```
Телеграмм-бот готов к работе.
# Адресные пути
- [Документация к API базе данных](http://127.0.0.1:8000/redoc)
- [Админ-панель базы данных](http://127.0.0.1:8000/admin)
# Авторы
Людмила Давлетова, Владимир Захаров, Мадина Муминова, Дмитрий Коломейцев, Константин Гашев
